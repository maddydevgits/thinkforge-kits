<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Canteen Occupancy Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'canteen-green': '#10B981',
                        'canteen-red': '#EF4444',
                        'canteen-yellow': '#F59E0B'
                    }
                }
            }
        }
    </script>
    <style>
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Mobile-specific optimizations */
        @media (max-width: 640px) {
            .mobile-text-sm { font-size: 0.875rem; }
            .mobile-text-xs { font-size: 0.75rem; }
            .mobile-p-4 { padding: 1rem; }
            .mobile-p-3 { padding: 0.75rem; }
            .mobile-gap-4 { gap: 1rem; }
            .mobile-gap-3 { gap: 0.75rem; }
        }
        
        /* Prevent zoom on input focus for iOS */
        input, select, textarea {
            font-size: 16px !important;
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-8">
        <!-- Header -->
        <div class="text-center mb-6 sm:mb-8">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 mb-2 px-2">üçΩÔ∏è Canteen Occupancy Monitor</h1>
            <p class="text-sm sm:text-base md:text-lg text-gray-600 px-4">Real-time people count to help you decide when to visit</p>
        </div>

        <!-- Main Card -->
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-6 md:p-8 mb-4 sm:mb-6">
                <!-- Occupancy Display -->
                <div class="text-center mb-6 sm:mb-8">
                    <div class="inline-block">
                        <div id="occupancy-circle" class="w-32 h-32 sm:w-40 sm:h-40 md:w-48 md:h-48 mx-auto rounded-full flex items-center justify-center text-white text-3xl sm:text-4xl md:text-6xl font-bold mb-3 sm:mb-4 pulse-animation">
                            <span id="occupancy-count">{{ data.occupancy }}</span>
                        </div>
                        <div class="text-lg sm:text-xl md:text-2xl font-semibold text-gray-700 mb-2 px-2">People Currently in Canteen</div>
                        <div id="status-indicator" class="inline-flex items-center px-3 sm:px-4 py-2 rounded-full text-xs sm:text-sm font-medium">
                            <span id="status-dot" class="w-2 h-2 rounded-full mr-2"></span>
                            <span id="status-text">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Status Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4 md:gap-6 mb-6 sm:mb-8">
                    <!-- Occupancy Status -->
                    <div class="bg-gray-50 rounded-lg sm:rounded-xl p-4 sm:p-6 text-center">
                        <div class="text-2xl sm:text-3xl mb-2">üìä</div>
                        <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-2">Current Status</h3>
                        <div id="occupancy-status" class="text-lg sm:text-xl md:text-2xl font-bold text-gray-600">Loading...</div>
                    </div>

                    <!-- Recommendation -->
                    <div class="bg-gray-50 rounded-lg sm:rounded-xl p-4 sm:p-6 text-center">
                        <div class="text-2xl sm:text-3xl mb-2">üí°</div>
                        <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-2">Recommendation</h3>
                        <div id="recommendation" class="text-sm sm:text-base md:text-lg font-medium text-gray-600">Loading...</div>
                    </div>

                    <!-- Last Updated -->
                    <div class="bg-gray-50 rounded-lg sm:rounded-xl p-4 sm:p-6 text-center sm:col-span-2 md:col-span-1">
                        <div class="text-2xl sm:text-3xl mb-2">üïí</div>
                        <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-2">Last Updated</h3>
                        <div id="last-updated" class="text-xs sm:text-sm text-gray-600">{{ data.last_updated or 'Never' }}</div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <button id="refresh-btn" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-semibold py-3 px-6 sm:px-8 rounded-lg transition duration-200 touch-manipulation">
                        üîÑ Refresh Now
                    </button>
                    <button id="auto-refresh-btn" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 active:bg-green-800 text-white font-semibold py-3 px-6 sm:px-8 rounded-lg transition duration-200 touch-manipulation">
                        ‚è∞ Auto Refresh: <span id="auto-refresh-status">OFF</span>
                    </button>
                </div>
            </div>

            <!-- Info Section -->
            <div class="bg-white rounded-lg sm:rounded-xl shadow-lg p-4 sm:p-6">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 px-2">üìã How to Use</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                    <div class="px-2">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-700 mb-3">Traffic Levels:</h3>
                        <ul class="space-y-2 sm:space-y-3 text-sm sm:text-base text-gray-600">
                            <li class="flex items-center"><span class="inline-block w-3 h-3 sm:w-4 sm:h-4 bg-green-500 rounded-full mr-2 flex-shrink-0"></span> 0-10 people: Low traffic</li>
                            <li class="flex items-center"><span class="inline-block w-3 h-3 sm:w-4 sm:h-4 bg-yellow-500 rounded-full mr-2 flex-shrink-0"></span> 11-25 people: Moderate traffic</li>
                            <li class="flex items-center"><span class="inline-block w-3 h-3 sm:w-4 sm:h-4 bg-red-500 rounded-full mr-2 flex-shrink-0"></span> 26+ people: High traffic</li>
                        </ul>
                    </div>
                    <div class="px-2">
                        <h3 class="text-base sm:text-lg font-semibold text-gray-700 mb-3">Tips:</h3>
                        <ul class="space-y-2 sm:space-y-3 text-sm sm:text-base text-gray-600">
                            <li>‚Ä¢ Check before heading to the canteen</li>
                            <li>‚Ä¢ Data updates every 30 seconds</li>
                            <li>‚Ä¢ Green = Good time to visit</li>
                            <li>‚Ä¢ Red = Consider waiting</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let autoRefreshEnabled = false;

        // Update UI based on occupancy count
        function updateUI(data) {
            const count = data.occupancy || 0;
            const circle = document.getElementById('occupancy-circle');
            const statusIndicator = document.getElementById('status-indicator');
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const occupancyStatus = document.getElementById('occupancy-status');
            const recommendation = document.getElementById('recommendation');
            const lastUpdated = document.getElementById('last-updated');

            // Update count
            document.getElementById('occupancy-count').textContent = count;

            // Update circle color and status
            if (count <= 10) {
                circle.className = 'w-32 h-32 sm:w-40 sm:h-40 md:w-48 md:h-48 mx-auto rounded-full flex items-center justify-center text-white text-3xl sm:text-4xl md:text-6xl font-bold mb-3 sm:mb-4 pulse-animation bg-canteen-green';
                statusDot.className = 'w-2 h-2 rounded-full mr-2 bg-green-500';
                statusText.textContent = 'Low Traffic';
                occupancyStatus.textContent = 'Low Traffic';
                recommendation.textContent = 'Great time to visit!';
            } else if (count <= 25) {
                circle.className = 'w-32 h-32 sm:w-40 sm:h-40 md:w-48 md:h-48 mx-auto rounded-full flex items-center justify-center text-white text-3xl sm:text-4xl md:text-6xl font-bold mb-3 sm:mb-4 pulse-animation bg-canteen-yellow';
                statusDot.className = 'w-2 h-2 rounded-full mr-2 bg-yellow-500';
                statusText.textContent = 'Moderate Traffic';
                occupancyStatus.textContent = 'Moderate Traffic';
                recommendation.textContent = 'Decent time to visit';
            } else {
                circle.className = 'w-32 h-32 sm:w-40 sm:h-40 md:w-48 md:h-48 mx-auto rounded-full flex items-center justify-center text-white text-3xl sm:text-4xl md:text-6xl font-bold mb-3 sm:mb-4 pulse-animation bg-canteen-red';
                statusDot.className = 'w-2 h-2 rounded-full mr-2 bg-red-500';
                statusText.textContent = 'High Traffic';
                occupancyStatus.textContent = 'High Traffic';
                recommendation.textContent = 'Consider waiting';
            }

            // Update last updated time
            if (data.last_updated) {
                const date = new Date(data.last_updated);
                lastUpdated.textContent = date.toLocaleString();
            }

            // Update status indicator
            if (data.status === 'error') {
                statusDot.className = 'w-2 h-2 rounded-full mr-2 bg-red-500';
                statusText.textContent = 'Connection Error';
            }
        }

        // Fetch data from API
        async function fetchData() {
            try {
                const response = await fetch('/api/occupancy');
                const data = await response.json();
                updateUI(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                updateUI({ occupancy: 0, status: 'error', error: error.message });
            }
        }

        // Toggle auto refresh
        function toggleAutoRefresh() {
            if (autoRefreshEnabled) {
                clearInterval(autoRefreshInterval);
                autoRefreshEnabled = false;
                document.getElementById('auto-refresh-status').textContent = 'OFF';
                document.getElementById('auto-refresh-btn').className = 'w-full sm:w-auto bg-green-600 hover:bg-green-700 active:bg-green-800 text-white font-semibold py-3 px-6 sm:px-8 rounded-lg transition duration-200 touch-manipulation';
            } else {
                autoRefreshInterval = setInterval(fetchData, 30000); // 30 seconds
                autoRefreshEnabled = true;
                document.getElementById('auto-refresh-status').textContent = 'ON';
                document.getElementById('auto-refresh-btn').className = 'w-full sm:w-auto bg-red-600 hover:bg-red-700 active:bg-red-800 text-white font-semibold py-3 px-6 sm:px-8 rounded-lg transition duration-200 touch-manipulation';
            }
        }

        // Event listeners
        document.getElementById('refresh-btn').addEventListener('click', fetchData);
        document.getElementById('auto-refresh-btn').addEventListener('click', toggleAutoRefresh);

        // Initial data load
        document.addEventListener('DOMContentLoaded', function() {
            updateUI({{ data | tojson }});
        });
    </script>
</body>
</html>
